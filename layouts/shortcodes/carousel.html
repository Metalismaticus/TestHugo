{{/* Carousel v3
Usage:
  {{< carousel items="1" height="500" unit="px" duration="7000" maxw="max-w-5xl" radius="rounded-2xl" >}}
    <img src="/uploads/evangelion/1.jpg" alt="...">
    <hr>
    <img src="/uploads/evangelion/2.jpg" alt="...">
  {{< /carousel >}}
  или самозакрытый, если используете data:
  {{< carousel items="1" height="500" unit="px" duration="7000" />}}
*/}}

{{- $items := .Get "items" | default "1" -}}
{{- $height := .Get "height" | default "500" -}}
{{- $unit := .Get "unit" | default "px" -}}
{{- $duration := .Get "duration" | default "7000" -}}
{{- $maxw := .Get "maxw" | default "max-w-5xl" -}}
{{- $radius := .Get "radius" | default "rounded-xl" -}}

{{- if not (.Page.Scratch.Get "hc_carousel_included") -}}
  <link rel="stylesheet" href="{{ "css/carousel.css" | relURL }}">
  <script defer src="{{ "js/carousel.js" | relURL }}"></script>
  {{- .Page.Scratch.Set "hc_carousel_included" true -}}
{{- end -}}

{{- $slides := slice -}}
{{- with site.Data.carousel -}}
  {{- with .images -}}
    {{- range . -}}{{- $slides = $slides | append . -}}{{- end -}}
  {{- end -}}
{{- end -}}

{{- $inner := .Inner | default "" -}}
{{- $innerTrim := trim $inner "\r\n\t " -}}

<div class="hc-slider w-full {{ $maxw }} mx-auto {{ $radius }}" data-items="{{ $items }}" data-duration="{{ $duration }}">
  <div class="hc-viewport" style="height: {{ $height }}{{ $unit }};">
    <div class="hc-track">

      {{- if gt (len $innerTrim) 0 -}}
        {{/* 1) Если внутри есть контент — используем его */}}
        {{- $parts := split $inner "<hr>" -}}
        {{- range $i, $p := $parts -}}
          <div class="hc-slide">
            {{- /* Разрешаем как <img>, так и произвольный HTML в подписи */ -}}
            {{- if in (lower $p) "<img" -}}
              {{ $p | safeHTML }}
            {{- else -}}
              <div class="hc-caption">{{ $p | safeHTML }}</div>
            {{- end -}}
          </div>
        {{- end -}}

      {{- else if gt (len $slides) 0 -}}
        {{/* 2) Иначе — берём слайды из data */}}
        {{- range $i, $s := $slides -}}
          {{- $cap := or $s.caption_html $s.content_html -}}
          {{- $href := or $s.href $s.link -}}
          <div class="hc-slide">
            {{- if $href -}}<a href="{{ $href | relURL }}" {{ with $s.target }}target="{{ . }}" rel="noopener"{{ end }} class="hc-link">{{- end -}}
              <img src="{{ $s.image | relURL }}" alt="slide {{ add $i 1 }}">
              {{- with $cap -}}<div class="hc-caption">{{ . | safeHTML }}</div>{{- end -}}
            {{- if $href -}}</a>{{- end -}}
          </div>
        {{- end -}}
      {{- end -}}

    </div>

    <button class="hc-arrow hc-prev" aria-label="Previous">‹</button>
    <button class="hc-arrow hc-next" aria-label="Next">›</button>
    <div class="hc-bullets" aria-label="Carousel pagination"></div>
  </div>
</div>
